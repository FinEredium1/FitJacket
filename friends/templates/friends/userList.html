{% extends 'base.html' %}

{% block content %}
  <h2>Users of FitJacket</h2>
  <ul>
    {% for user in users %}
      <li>
        {{ user.username }}
        {% if user.id in friends %}
          <span>- Friends</span>
          <form method="post" action="{% url 'friends:removeFriend' user.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit">Remove Friend</button>
          </form>
          <form method="post" action="{% url 'friends:inviteToGroup' 0 user.id %}" style="display:inline;">
            {% csrf_token %}
            <select name="group_id">
                {% for group in groups %}
                <option value="{{ group.id }}">{{ group.name }}</option>
              {% endfor %}
            </select>
            <button type="submit">Invite to Group</button>
          </form>
        {% elif user.id not in sent_requests %}
          <form method="post" action="{% url 'friends:sendRequest' user.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit">Add Friend</button>
          </form>
        {% else %}
          <em>Request Sent</em>
        {% endif %}
      </li>
    {% empty %}
      <li>No other users found.</li>
    {% endfor %}
  </ul>

  <h2>Incoming Friend Requests</h2>
  <ul>
    {% for request in received_requests %}
      <li>
        {{ request.from_user.username }}
        <form method="post" action="{% url 'friends:respondRequest' request.id %}" style="display:inline;">
          {% csrf_token %}
          <button name="action" value="accept" type="submit">Accept</button>
          <button name="action" value="reject" type="submit">Reject</button>
        </form>
      </li>
    {% empty %}
      <li>No incoming requests.</li>
    {% endfor %}
  </ul>
      <h2>Create a Workout Group</h2>
    <form method="post" action="{% url 'friends:createGroup' %}">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit">Create Group</button>
    </form>
    {% for group in groups %}
  <div>
    <strong>{{ group.name }}</strong>
      <form method="post" action="{% url 'friends:leaveGroup' group.id %}">
        {% csrf_token %}
        <button type="submit">Leave Group</button>
      </form>
  </div>
  <h2>Group Invites</h2>
<ul>
  {% for invite in group_invites %}
    <li>
      You were invited to <strong>{{ invite.group.name }}</strong> by {{ invite.from_user.username }}
      <form method="post" action="{% url 'friends:respondGroupInvite' invite.id %}" style="display:inline;">
        {% csrf_token %}
        <button name="action" value="accept" type="submit">Accept</button>
      </form>
    </li>
  {% empty %}
    <li>No group invites.</li>
  {% endfor %}
</ul>
{% endfor %}
{% endblock %}